soniquedna.deepsantoshwar.xyz {
    # Route API calls to backend FIRST (before any file serving)
    @api {
        path /spotify-auth-url*
        path /exchange-token*
        path /refresh-token*
        path /check-token*
        path /spotify-profile*
        path /logout*
        path /spotify-session-clear*
        path /musicrecommendation*
        path /music-recommendation*
        path /crossdomain-recommendations*
        path /crossdomain-progress*
        path /create-playlist*
        path /test-database*
        path /user-analytics*
        path /user-history*
        path /clear-cache*
        path /recommendations*
        path /auth*
        path /playlists*
        path /callback*
        path /health*
    }
    
    # Proxy API calls to backend
    reverse_proxy @api http://localhost:5500
    
    # Serve frontend files for everything else
    root * /home/ubuntu/SoniqueDNA/frontend/dist
    file_server
    
    # Handle SPA routing
    @notFile {
        not path *.js
        not path *.css
        not path *.ico
        not path *.png
        not path *.jpg
        not path *.jpeg
        not path *.gif
        not path *.svg
        not path *.woff
        not path *.woff2
        not path *.ttf
        not path *.eot
    }
    rewrite @notFile /index.html
} 